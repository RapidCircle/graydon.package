<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Mark Zwart" />

<meta name="date" content="2018-11-05" />

<title>Handling of company hierarchies</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,html%2C%20body%20%7B%0Afont%2Dfamily%3A%20%22Roboto%22%2C%20%22Times%20New%20Roman%22%2C%20Times%2C%20serif%3B%0Afont%2Dweight%3A%20300%3B%0Aline%2Dheight%3A%201%2E4%3B%0Afont%2Dsize%3A%2014px%3B%0Acolor%3A%20%23000000%3B%0Abackground%2Dcolor%3A%20%23ECECEC%3B%0Amargin%3A%200%3B%0Apadding%3A%200%3B%0Awidth%3A%20100%25%3B%0Aheight%3A%20100%25%3B%0A%7D%0A%0Abody%20div%2Emain%2Dcontainer%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%2Dbottom%3A%2050px%3B%0Apadding%2Dtop%3A%2020px%3B%0Abox%2Dshadow%3A%200%202px%205px%20%23808080%3B%0Amargin%2Dtop%3A%2040px%3B%0Amargin%2Dbottom%3A%2040px%3B%0A%7D%0Adiv%2Etoc%2Dcontent%20%7B%0Apadding%3A%200%2015px%200%2030px%3B%0A%7D%0A%0A%23TOC%20%7B%0Aborder%2Dradius%3A%200%3B%0Aborder%2Dwidth%3A%200%3B%0Afont%2Dsize%3A%201rem%3B%0Afont%2Dweight%3A%20500%3B%0Acolor%3A%20%2300545D%3B%0A%7D%0A%23TOC%20%2Eactive%20%7B%0Abackground%2Dcolor%3A%20%23168FA7%3B%0Acolor%3A%20%23FFFFFF%3B%0A%7D%0A%23TOC%20li%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23ECECEC%3B%0Aheight%3A%2040px%3B%0Aline%2Dheight%3A%2032px%3B%0A%7D%0A%23TOC%20%3E%20ul%3Alast%2Dchild%20%3E%20li%3Alast%2Dchild%20%7B%0Aborder%3A%200%3B%0A%7D%0A%0Ah1%2C%20h2%2C%20h3%20%7B%0Afont%2Dfamily%3A%20%22Roboto%22%2C%20%22Times%20New%20Roman%22%2C%20Times%2C%20serif%3B%0Afont%2Dweight%3A%20700%3B%0Acolor%3A%20%2300545D%3B%0A%7D%0Ah4%2C%20h5%2C%20h6%20%7B%0Afont%2Dweight%3A%20500%3B%0Acolor%3A%20%23000000%3B%0A%7D%0Ah1%20%7B%20font%2Dsize%3A%202%2E25rem%3B%20%7D%0Ah2%20%7B%20font%2Dsize%3A%201%2E875rem%3B%20%7D%0Ah3%20%7B%20font%2Dsize%3A%201%2E5rem%3B%20%7D%0Ah4%20%7B%20font%2Dsize%3A%201%2E25rem%3B%20%7D%0Ah5%20%7B%20font%2Dsize%3A%201%2E125rem%3B%20%7D%0Ah6%20%7B%20font%2Dsize%3A%201rem%3B%20%7D%0Ah4%2Eauthor%20%3E%20em%2C%20h4%2Edate%20%3E%20em%20%7B%0Afont%2Dfamily%3A%20%22Roboto%22%2C%20%22Times%20New%20Roman%22%2C%20Times%2C%20serif%3B%0Afont%2Dstyle%3A%20normal%3B%0Afont%2Dweight%3A%20400%3B%0Acolor%3A%20%23858587%3B%0A%7D%0A%0Aul%3Anot%28%5Bclass%5D%29%20%7B%0Afont%2Dsize%3A%201rem%3B%0Alist%2Dstyle%3A%20none%3B%0A%7D%0Aul%3Anot%28%5Bclass%5D%29%20li%3Abefore%20%7B%0Acolor%3A%20%23EB6E08%3B%0Acontent%3A%20%22%5C2022%22%3B%0Amargin%2Dleft%3A%20%2D0%2E75em%3B%0Aposition%3A%20relative%3B%0Atop%3A%200%2E125em%3B%0Aline%2Dheight%3A%200%3B%0Apadding%2Dright%3A%200%2E25em%3B%0Afont%2Dsize%3A%201%2E5em%3B%0A%7D%0A%0Aa%20%7B%0Acolor%3A%20%23168FA7%3B%0A%7D%0A%0Aul%2Enav%20%7B%0Afont%2Dweight%3A%20500%3B%0A%7D%0Aul%2Enav%20a%20%7B%0Acolor%3A%20%23168FA7%3B%0A%7D%0A%0A%0A%2Epagedtable%2Dwrapper%20%7B%0Afont%2Dsize%3A%201rem%3B%0Aborder%2Dwidth%3A%200%3B%0A%7D%0A%2Epagedtable%2Dwrapper%20%2Epagedtable%20%7B%0Apadding%3A%200%3B%0A%7D%0A%2Epagedtable%2Dwrapper%20a%20%7B%0Acolor%3A%20%23168FA7%3B%0A%7D%0A%2Epagedtable%2Dwrapper%20a%2Epagedtable%2Dindex%2Dnav%2Ddisabled%20%7B%0Acolor%3A%20%23999%3B%0A%7D%0A%2Epagedtable%2Dwrapper%20a%2Epagedtable%2Dindex%2Dcurrent%20%7B%0Acolor%3A%20%23333%3B%0A%7D%0A%0Atable%20thead%20%7B%0Afont%2Dsize%3A%200%2E7em%3B%0Acolor%3A%20%23FFFFFF%3B%0Abackground%2Dcolor%3A%20%2300545D%3B%0A%7D%0Atable%20tr%2Eodd%20%7B%0Afont%2Dsize%3A%200%2E7em%3B%0Abackground%2Dcolor%3A%20%23EFF0F0%3B%0A%7D%0Atable%20tr%2Eeven%20%7B%0Afont%2Dsize%3A%200%2E7em%3B%0Abackground%2Dcolor%3A%20%23DFE0E1%3B%0A%7D%0A%0Abutton%2C%20input%20%7B%0Afont%2Dsize%3A%2001rem%3B%0Aborder%2Dradius%3A%200%2E25em%3B%0Amargin%2Dbottom%3A%200%2E625em%3B%0Apadding%3A%200%2E625em%3B%0Aoutline%3A%20none%3B%0A%7D%0Ainput%5Btype%3Dtext%5D%2C%20input%5Btype%3Dnumber%5D%2C%20select%20%7B%0Afont%2Dweight%3A%20300%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Amin%2Dwidth%3A%2012em%3B%0A%7D%0Abutton%2C%20input%5Btype%3Dsubmit%5D%20%7B%0Afont%2Dweight%3A%20900%3B%0Aborder%3A%20none%3B%0Apadding%3A%200%2E625em%201%2E875em%3B%0Abackground%2Dcolor%3A%20%23EB6E08%3B%0Acolor%3A%20%23FFFFFF%3B%0Acursor%3A%20pointer%3B%0Amin%2Dwidth%3A%20inherit%3B%0A%7D%0Abutton%3Ahover%2C%20input%5Btype%3Dsubmit%5D%3Ahover%20%7B%0Abackground%2Dcolor%3A%20%23f29d63%3B%0A%7D%0A%0Aimg%2C%20iframe%20%7B%0Adisplay%3A%20block%3B%0Amargin%3A%200%20auto%3B%0A%7D%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Handling of company hierarchies</h1>
<h4 class="author"><em>Mark Zwart</em></h4>
<h4 class="date"><em>2018-11-05</em></h4>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>Our database contains the relations between companies by a parent child relation, the total tree of company relations actually contains a lot of information about a company that is in it. This package contains several functions that is useful for extracting this kind of information.</p>
<p>First let’s load the package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(graydon.package)</code></pre></div>
<div id="the-example-data" class="section level3">
<h3>The example data</h3>
<p>The package contains a data frame, <em>tbl_company_relations</em> which is an ex(s)ample of how companie relations are typically represented in our database. The data frame contains the following columns:</p>
<table>
<thead>
<tr class="header">
<th align="left">Column.names</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">id_company</td>
</tr>
<tr class="even">
<td align="left">id_company_parent</td>
</tr>
<tr class="odd">
<td align="left">code_sbi</td>
</tr>
<tr class="even">
<td align="left">size_company</td>
</tr>
<tr class="odd">
<td align="left">qty_employees</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="creating-a-company-hierarchy-graph" class="section level1">
<h1>Creating a company hierarchy graph</h1>
<p>Company relations in our database are represented in parent-child relations, but this doesn’t give you the complete overview of how companies fit together in their complete hierarchy. [Graphs](<a href="https://en.wikipedia.org/wiki/Graph_(discrete_mathematics)" class="uri">https://en.wikipedia.org/wiki/Graph_(discrete_mathematics)</a> provide a way of getting those overviews. Let’s load the <a href="http://igraph.org/r/doc/"><em>igraph</em></a> library first:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(igraph)</code></pre></div>
<p>With a simple function call we can create a graph, based on those parent-child relationships expressed in a table. Make sure the child and the parent ID columns are the first and second column in the table respectively.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">graph_company_hierarchies &lt;-<span class="st"> </span><span class="kw">create_graph_company_hierarchies</span>(tbl_company_relations)</code></pre></div>
<p>The resulting graph represents a network of all individual company hierarchies in one big ‘space’ which can be graphically represented like below. You can see this plot is pretty useless in in itself, but this ‘space’ of hierarchies can be used as a ‘database’ to easily retrieve the desired company hierarchies which are usefull for plotting and doing calculations within those.</p>
<p>The <em>plot_graydon_graph</em> function is used to plot graphs using graydon colors, the extra parameters <em>vertex.label</em>, <em>vertex.size</em> and <em>edge.arrow.size</em> are set so they override the defaults.</p>
<p><img src="data:image/png;base64,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rw1HP/J0dKnirp7cxdc/owWQ5RlGj24tetP5ppEHIbO+dnLXXv6UkBFHNdZrHWvLk4UzXboYStUnAHpp6QbF0smsJ2LaBU+rsIndPN5fZfjupz+w8JYzLz8O/V6tjwFU5eZUEkM86Rt/vs2SPg1QLT0b9jz68uIVbZ+/T+i+oU5p6XstZ32Kl751QvcOx/WX84plYd1oPv0DAbnQJytVar8bzpjI7SOelPVyZhrHGu/XxwIaegTJqs8G9AESICIBIhIgIgEiEiAiASISICIBIhIgIgEiEiAiASISICIBIhIgIgEiEiAiASISICIBIhIgIgEiEiAiASISICIBIhIgIgEiEiAiASISICIBIhIgIgEiEiAiASISICIBIhIgIgEiEiAiASISICIBIhIgIgEiEiAiASISICIBIhIgIgEiEiAiASISICIBIhIgIgEiEiAiASISICIBIhIgIgEiEiAiASISICIBIhIgIgEiEiAiASISICIBIhIgIgEiEiAiASISICIBIhIgIgEiEiAiASISICIBIhIgIgEiEiAiASISICIBIhIgIgEiEiAiASISICIBIhIgIgEiEiCifwAqEaPFMfMaSwAAAABJRU5ErkJggg==" /><!-- --></p>
</div>
<div id="selecting-company-hierarchies-graphs" class="section level1">
<h1>Selecting company hierarchies graphs</h1>
<p>There are a few ways which we can select the distinct company hierarchies so we can make useful calculations or plots about them.</p>
<div id="selecting-a-hierarchy-by-company-id" class="section level2">
<h2>Selecting a hierarchy by company ID</h2>
<p>If you have a single company that you want to find out about more you can select it using the function <em>find_company_hierarchy</em>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">id_company_selected &lt;-<span class="st"> &quot;931238099&quot;</span>
  
graph_company_hierarchy &lt;-<span class="st"> </span><span class="kw">find_company_hierarchy</span>(graph_company_hierarchies, id_company_selected)</code></pre></div>
<p>The resulting graph has the logical attribute <em>is_searched_company</em> set to <em>TRUE</em> of the searched for company. Let’s plot this graph, highlighting the searched for companies:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">graph_company_hierarchy &lt;-<span class="st"> </span><span class="kw">mark_companies_logical</span>(graph_company_hierarchy,
                                      <span class="st">&quot;is_searched_company&quot;</span>,
                                      <span class="st">&quot;id_company&quot;</span>,
                                      id_company_selected)

igraph<span class="op">::</span><span class="kw">V</span>(graph_company_hierarchy)<span class="op">$</span>color &lt;-<span class="st"> </span><span class="kw">ifelse</span>(igraph<span class="op">::</span><span class="kw">V</span>(graph_company_hierarchy)<span class="op">$</span>is_searched_company,
                                                   col_graydon[<span class="dv">2</span>],
                                                   col_graydon[<span class="dv">4</span>])
<span class="kw">plot_graydon_graph</span>(graph_company_hierarchy)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="selecting-hierarchies-with-a-vector-of-company-ids" class="section level2">
<h2>Selecting hierarchies with a vector of company IDs</h2>
<p>A customer’s file contains multiple companies of which we might want to calculate, or show (parts) of their hierarchy. The <em>list_selected_hierarchies</em> function can be used to put the graphs of all these companies in a list. In this example we have a data frame <em>tbl_customers</em> with the column <em>id_company</em>, of which we want to retrieve all the graphs.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">list_selected_hierarchies &lt;-<span class="st"> </span><span class="kw">select_graph_hierarchies</span>(graph_company_hierarchies, 
                                                      tbl_customers<span class="op">$</span>id_company)</code></pre></div>
<p>The <em>tbl_customers</em> data-frame contains 300, while the <em>list_selected_hierarchies</em> contains 246 graphs. This is because there are a customers that fall withing the same company hierarchy. The vertices in the graphs in this list now also contain an extra logical attribute <em>is_searched_company</em> which indicates whether the vertex was in the <em>id_company</em> column. Let’s take a look at one of the graphs that contain multiple customers. The customer ‘vertices’ are colored orange here:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">igraph<span class="op">::</span><span class="kw">V</span>(graph_example)<span class="op">$</span>color &lt;-<span class="st"> </span><span class="kw">ifelse</span>(igraph<span class="op">::</span><span class="kw">V</span>(graph_example)<span class="op">$</span>is_searched_company,
                                                   col_graydon[<span class="dv">2</span>],
                                                   col_graydon[<span class="dv">4</span>])

<span class="kw">plot_graydon_graph</span>(graph_example,
                   <span class="dt">vertex.label =</span> <span class="st">&quot;&quot;</span>)</code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAD1BMVEWFhYeLsN66v8Hrbgj////AvDdNAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAEf0lEQVR4nO3d0VbqMBQA0Rr5/2++QhXT0nYC0uTkZuZFYYnGvUpbQoDpYodNrQcQPYEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBoIBA0xRpUJHGMjd9fHwEGlWgocxdfSIJxRnJdwJBAlHugyiPYlwq/LkKll0DTZ+fn2f/AzGByoSuPqcLCUR/5Nxf/2oCQWU7oYH3QaVCox7FyoBKTwb+VMdAVXwEoqIC8b9fx6dfoEo+3QLV8okLBAQCHRNU8+kUqJ5Pn0AVfQIDHTAIdGuXoaZPj0BVfQSiGgAVz1FsS9T1aQBU/rzXJkVln/pATzxzumVR2yc00JaGQHmPGtV9mu2D0ktzqvV9Gh7FCojWP9HAp+l5UEKjdHixSo1PFIEoHVyqVPMz6UOilG9kTXzaA+3f09Lc/P1lYKDL3maUA/H+6qRiAO1sRkugkbegWxsCd5XUTCgQUL4Z3b9mG9DwW9CtbKecX2y2CwoHNG9Gq02pHU9EoMtil3z7+pzPexcNhQRaCD3t896F6CGBUnaO+LU9pOx6vO27X8oQGujLI1uGuH8kS/kNRgD6KaX7QtY7QNoov81QQPeVvjsY2zcZYB/02+MWVHCbAY5iP833sen34ghz0uXdPPKj2BiT9gXl96d2M0FzIYEWM0EXH2o8lk8EfV9uNZSQQOvHYs4oLkr5w6/FhNCAT/tstJgQWk4pthhONKCVwgKowXCiAa0RFjtrgR63kdXRvvaArsUB2n5SY3HPGnknfTDTk1+sM5i8IEClK1oHfSy2f4Bqv4QqANDR8bv9IrzmQMenN+2Xcfa0gGr/uhNrCvTsEryDK0+rCdA8a/zCKs6ja0+qBdA8z/zSOuDDq0+pxTLg8jdtCfCCn9BA+w71hDoF+r9fFl78tj+HK4TfNBiq4VGMe/Yc8oyan0kf9fxZ5PsTCIoM9NJ59rvrGaiKUNdANYT6Bqog1DnQ18+c/FaBvQOd/vbTgYGKfU4VEoj+wHm/+q8JBJUdodwHUeMexVou3fwtLlAMH4EogaC4QEGKChTm41mCDGNdnA/4iTGKdYE+IirEIB4SCBKIch9EeRTrJYEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggaB/UkIJbhXvBAYAAAAASUVORK5CYII=" /><!-- --></p>
</div>
<div id="listing-all-hierarchy-graphs" class="section level2">
<h2>Listing all hierarchy graphs</h2>
<p>For whatever reason you might want to creating a list of all of the seperate company hierarchies out of the complete company hierarchy ‘space’.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">list_all_graphs &lt;-<span class="st"> </span><span class="kw">list_company_hierarchy_graphs</span>(graph_company_hierarchies)</code></pre></div>
</div>
</div>
<div id="converting-company-hierarchy-graphs-to-data-frames" class="section level1">
<h1>Converting company hierarchy graphs to data-frames</h1>
<p>Having graphs is nice for creating beautiful plots and useful calculations, but for the data to be useful for further processing getting data from the graph into a data-frame format is handy.</p>
<div id="converting-a-single-hierarchy-graph" class="section level2">
<h2>Converting a single hierarchy graph</h2>
<p>With the function <em>hierarchy_as_data_frame</em> you can turn a graph into a data-frame. Before we created the graph <em>graph_company_hierarchy</em> by searching for hierarchies by companies and set the colors to their being in the searched-for companies, this is reflected by the <em>graph_company_hierarchy</em> and <em>color</em> columns respectively.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_single_hierarchy &lt;-<span class="st"> </span><span class="kw">hierarchy_as_data_frame</span>(graph_company_hierarchy)</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="right">id_company_parent</th>
<th align="left">code_sbi</th>
<th align="right">size_company</th>
<th align="right">qty_employees</th>
<th align="left">is_searched_company</th>
<th align="left">color</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1003667</td>
<td align="right">931238099</td>
<td align="left">7022</td>
<td align="right">2</td>
<td align="right">15</td>
<td align="left">FALSE</td>
<td align="left">#8BB0DE</td>
</tr>
<tr class="even">
<td align="left">931238099</td>
<td align="right">933898487</td>
<td align="left">6420</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">#EB6E08</td>
</tr>
<tr class="odd">
<td align="left">933898487</td>
<td align="right">911277358</td>
<td align="left">7022</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">FALSE</td>
<td align="left">#8BB0DE</td>
</tr>
<tr class="even">
<td align="left">936298138</td>
<td align="right">931238099</td>
<td align="left">7311</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="left">FALSE</td>
<td align="left">#8BB0DE</td>
</tr>
<tr class="odd">
<td align="left">911277358</td>
<td align="right">NA</td>
<td align="left">6420</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="left">#8BB0DE</td>
</tr>
</tbody>
</table>
</div>
<div id="converting-a-list-of-hierarchy-graphs" class="section level2">
<h2>Converting a list of hierarchy graphs</h2>
<p>A list of graphs can also be converted into a data-frame using <em>hierarchy_list_as_data_frame</em>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_selected_hierarchies &lt;-<span class="st"> </span><span class="kw">hierarchy_list_as_data_frame</span>(list_selected_hierarchies)</code></pre></div>
</div>
</div>
<div id="calculating-properties" class="section level1">
<h1>Calculating properties</h1>
<div id="propagating-values" class="section level2">
<h2>Propagating values</h2>
<p>It might come in handy to cumulate values in the hierarchy bottom up; this is where the <em>aggregate_company_hierarchy_value</em> function comes in handy. In this example the companies will get a new attribute <em>qty_employees_cum</em> which will contain the sum of all the <em>qty_employees</em> of the companies that below the company within the hierarchy.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">graph_company_hierarchy &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">aggregate_company_hierarchy_value</span>(<span class="dt">graph =</span> graph_company_hierarchy, 
                                    <span class="dt">name_attribute =</span> <span class="st">&quot;qty_employees&quot;</span>,
                                    <span class="dt">name_aggregate =</span> <span class="st">&quot;qty_employees_cum&quot;</span>,
                                    <span class="dt">FUN =</span> sum, 
                                    <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>The result can be found can be shown in a graph, where we can see the original values and the rolled up values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">igraph<span class="op">::</span><span class="kw">V</span>(graph_company_hierarchy)<span class="op">$</span>label &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;# &quot;</span>,
                                                   igraph<span class="op">::</span><span class="kw">V</span>(graph_company_hierarchy)<span class="op">$</span>qty_employees,
                                                   <span class="st">&quot; -&gt; Cum # &quot;</span>,
                                                   igraph<span class="op">::</span><span class="kw">V</span>(graph_company_hierarchy)<span class="op">$</span>qty_employees_cum)

<span class="kw">plot_graydon_graph</span>(graph_company_hierarchy)</code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAABL1BMVEUAAAAAAB8AADIAADoAK20ALAYANWAAOmYAOpAARp4ATIoAZrYfH0wgJ30qAAAqK201GQQ1HwA1X3Q4Y784fr84ft46AAA6AGY6OgA6OmY6OpA6ZpA6ZrY6kNtKK01KTCxKiMFLHwBOJwBePgZeTgZeTghfNR9mAABmADpmAGZmOgBmOjpmOmZmOpBmZjpmkNtmtttmtv9yhYd3sN6EGQCFTACFTCyFXzaFX0yFckyFhYeFiE2FpMGLflmLfn2Ll32LsL+LsN6QOgCQOjqQOmaQZpCQtpCQ2/+gv8G2ZgC2Zjq2tma229u22/+2//+6pG26v4q6v8HbkDrbkGbbtpDb29vb2//b///rTgPrTgTrXgTrbgbrbgj/tmb/tpD/25D/27b/29v//7b//9v////qMSlzAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAGjElEQVR4nO3dCXMTZRyA8VUUqvUGikBRxJNLwBPjRUDFVltNPYLSmEr2+38Gs8nm3uRJ4ibvC/M8M0w7SZfZ/eVN0u7+p01Sm1kSegdiTyBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCBIIEggSCCoVKDmduv7evbJv7tn9tP0IEmSC+Nfc3QlOXZj+c3XXqlAjQvN7exj8+wPl9tHuHNr8ktad2+2/xXcMd/m669EoEfvtx/yZLP7eXaEu/f79zXO73U/aZ6rVyq3bzY2M4BH1z5MNn7a6q6TWZuP1F9ou0myXR+/d54VWrjhlEpdQbv3D/JHPTvC1t0kObGf3/X7lbM/Zx8bm5VqtVrJgT6439rZqDcv79Pmw/UWWmOjPrkW51mhhRtOq0yg1nf7vUe9swT+qLd2NrN9Tjbaj9c/W9k+NY5Xsz7vAl2vpwcXul88dfOxBgvtaG/wNFxohQ5viJUI1Mh24Fj3EDtH+Ge2YPI7eyuo+cLH1eo3pwqAZm4+3GChpUfXlluhQxtSZa6g5o3siDtlR/jo8l5rNz/C/iPceutU9c6l01+cqx9dGVtBMzYfbnihXc0+WWaFXp3y+jZZmUCNW83e23JnnxpbnT0f7ejV5OmTldZnyYnXxw5grs2HF1rr3uAwF1qhwxtSAb5RrFQq2YdabbnN+wutdW/wOrLQCh3eEAv5nfRyRP2F1lkSo2us/T/mK3R3xgot2HB6YX/UWHYVzfzf8hVaUqF/FiuPqFzsfqGBSjqw2op4YgAqgWhlOmkcQP/zCFfJEwvQ8ke5uudWXixAyxGtWieNCWjxw10DT1xACx3yyp9beXEBDYjg6Nekk8YHlB97MUBt+EvWVHxAneMvJOjeuK7nVl6MQB2ESYbObevVSYMD9c+j/7aVbA9uzoFGT8CPqI1eItoZnO8vu8BA/Ss9Z/aGzqPXuo2egB9dVWOXiNrtruYqUVCgwXn07BzyQX4+sXH+qy7QLy+318jt1zpnBy/++sabyTNfvjTlElH7w/V5L+QsVuAV1DuPPgw0OAH/fK1WOTx8cDytfXqxewL+x+JLROnQ1iUXFqh/Hr0HNHoCfjNt+xw+eLZSo0tEvdvLLyjQ4Dx64QrKrnEd/vVOGwgvEa1sAQVeQf3z6MMv0oMT8HdvVh5+8u7fr3xEl4gWuk6xWGGBBld6Rt/m89pv80+9ffjwvTkuEa3mPT4NDTRH5Z6CX7zogUIXP9C6f7YYSyBIIEggSCBIIEggSCAoeqDAPgJRAkECQQJBAkECQQJBAkECQQJBAkECQXED5WMeIXchbqDiSaq19hgAhd0DgaD4gQLvQeRA6x/aHE8gSCAoKNCUIeC8zhBwsc/ahoBDj+AVDgHndYeAL87ecNVDwEGBpg0BD34LR38IGH5PzOqGgAOvoNlDwO0bK9Xq18fx98SkK5zhDArEQ8DVNtBzEzOuaxwCDgo0xxBw9ZtTBUBrHAIOu4J4CPjOpdPfvhhyCDgs0BxDwCerd4IOAUf/jWLoIeDogcIXO1DonzQEogSCBIIEggSCBIIiBwruIxAlECQQJBAkECQQJBAkEBQzUATzZXEDRTBf9hgAhd4HgaCogSIYMBOIEgiKHSj0HoQEGvtzYmN158sKgSb/Dtncf+tp8UJOd0yMiQ2Vz5cVAo1uWDieVl7BgArGxNKl5sueVKCCMbGsJebLsqfY6vYyHNDEmNiS82XNs3sL/bGeBQsGNDkm1mnx+bKR8bTyC7eCxsfEOi0xX9Y40X4NehKBxsfExpp/viwbT3si3+a58PNlkQPFkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQJBAkECQQNB/L9R11ovDGMYAAAAASUVORK5CYII=" /><!-- --></p>
</div>
<div id="adding-graph-statistics" class="section level2">
<h2>Adding graph statistics</h2>
<p>Some overall statistics about the hierarchy can be added to the individual companies by using the <em>add_company_hierarchy_stats</em> function. This function will add the following attributes * <em>is_tree</em> - A logical indicating whether the company hierarchy is a tree (which should always be the case). * <em>qty_comapny_hierarchy</em> - The the number of companies in the hierarchy. * <em>id_company_top</em> - The company ID of the highest company in the hierachy (ultimate mother). * <em>distance_to_top</em> - The number of companies between the current company and the ultimate mother company * <em>qty_child_companies</em> - The number of child companies. * <em>qty_sister_companies</em> - The number of sibling companies.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">graph_company_hierarchy &lt;-<span class="st"> </span><span class="kw">add_company_hierarchy_stats</span>(graph_company_hierarchy)</code></pre></div>
<p>Let’s look at the statistics:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_single_hierarchy &lt;-<span class="st"> </span><span class="kw">hierarchy_as_data_frame</span>(graph_company_hierarchy)</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="right">id_company_parent</th>
<th align="left">code_sbi</th>
<th align="right">size_company</th>
<th align="right">qty_employees</th>
<th align="left">is_searched_company</th>
<th align="right">qty_employees_cum</th>
<th align="left">is_tree</th>
<th align="right">qty_comapny_hierarchy</th>
<th align="left">id_company_top</th>
<th align="right">distance_to_top</th>
<th align="right">qty_child_companies</th>
<th align="right">qty_sister_companies</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1003667</td>
<td align="right">931238099</td>
<td align="left">7022</td>
<td align="right">2</td>
<td align="right">15</td>
<td align="left">FALSE</td>
<td align="right">15</td>
<td align="left">TRUE</td>
<td align="right">5</td>
<td align="left">911277358</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">931238099</td>
<td align="right">933898487</td>
<td align="left">6420</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="right">17</td>
<td align="left">TRUE</td>
<td align="right">5</td>
<td align="left">911277358</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">933898487</td>
<td align="right">911277358</td>
<td align="left">7022</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">FALSE</td>
<td align="right">17</td>
<td align="left">TRUE</td>
<td align="right">5</td>
<td align="left">911277358</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">936298138</td>
<td align="right">931238099</td>
<td align="left">7311</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="left">FALSE</td>
<td align="right">2</td>
<td align="left">TRUE</td>
<td align="right">5</td>
<td align="left">911277358</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">911277358</td>
<td align="right">NA</td>
<td align="left">6420</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">18</td>
<td align="left">TRUE</td>
<td align="right">5</td>
<td align="left">911277358</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">_mark_compan</td>
<td align="right">ies_logical_</td>
<td align="left"></td>
<td align="right"></td>
<td align="right"></td>
<td align="left"></td>
<td align="right"></td>
<td align="left"></td>
<td align="right"></td>
<td align="left"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
</tbody>
</table>
<p><em>get_siblings</em></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">id_siblings &lt;-<span class="st"> </span><span class="kw">get_sibling_ids</span>(graph_company_hierarchy, <span class="st">&quot;1003667&quot;</span>)

graph_company_hierarchy &lt;-<span class="st"> </span><span class="kw">mark_companies_logical</span>(graph_company_hierarchy,
                                                  <span class="dt">name_logical =</span> <span class="st">&quot;is_sibling&quot;</span>, 
                                                  <span class="dt">name_filter =</span> <span class="st">&quot;id_company&quot;</span>,
                                                  <span class="dt">set_criteria =</span> id_siblings
                                                  )

<span class="kw">V</span>(graph_company_hierarchy)<span class="op">$</span>color &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">V</span>(graph_company_hierarchy)<span class="op">$</span>is_sibling,
                                                   col_graydon[<span class="dv">2</span>],
                                                   col_graydon[<span class="dv">3</span>])

<span class="kw">plot_graydon_graph</span>(graph_company_hierarchy)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>Remember the table of customers? If we want to get all siblings of those companies we can use the function <em>get_siblings_df</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tbl_siblings &lt;-<span class="st"> </span><span class="kw">get_siblings_df</span>(graph_company_hierarchies, tbl_customers<span class="op">$</span>id_company)</code></pre></div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
