<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Mark Zwart" />

<meta name="date" content="2018-11-09" />

<title>Handling of company hierarchies</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,html%2C%20body%20%7B%0Afont%2Dfamily%3A%20%22Roboto%22%2C%20%22Times%20New%20Roman%22%2C%20Times%2C%20serif%3B%0Afont%2Dweight%3A%20300%3B%0Aline%2Dheight%3A%201%2E4%3B%0Afont%2Dsize%3A%2014px%3B%0Acolor%3A%20%23000000%3B%0Abackground%2Dcolor%3A%20%23ECECEC%3B%0Amargin%3A%200%3B%0Apadding%3A%200%3B%0Awidth%3A%20100%25%3B%0Aheight%3A%20100%25%3B%0A%7D%0A%0Abody%20div%2Emain%2Dcontainer%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%2Dbottom%3A%2050px%3B%0Apadding%2Dtop%3A%2020px%3B%0Abox%2Dshadow%3A%200%202px%205px%20%23808080%3B%0Amargin%2Dtop%3A%2040px%3B%0Amargin%2Dbottom%3A%2040px%3B%0A%7D%0Adiv%2Etoc%2Dcontent%20%7B%0Apadding%3A%200%2015px%200%2030px%3B%0A%7D%0A%0A%23TOC%20%7B%0Aborder%2Dradius%3A%200%3B%0Aborder%2Dwidth%3A%200%3B%0Afont%2Dsize%3A%201rem%3B%0Afont%2Dweight%3A%20500%3B%0Acolor%3A%20%2300545D%3B%0A%7D%0A%23TOC%20%2Eactive%20%7B%0Abackground%2Dcolor%3A%20%23168FA7%3B%0Acolor%3A%20%23FFFFFF%3B%0A%7D%0A%23TOC%20li%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23ECECEC%3B%0Aheight%3A%2040px%3B%0Aline%2Dheight%3A%2032px%3B%0A%7D%0A%23TOC%20%3E%20ul%3Alast%2Dchild%20%3E%20li%3Alast%2Dchild%20%7B%0Aborder%3A%200%3B%0A%7D%0A%0Ah1%2C%20h2%2C%20h3%20%7B%0Afont%2Dfamily%3A%20%22Roboto%22%2C%20%22Times%20New%20Roman%22%2C%20Times%2C%20serif%3B%0Afont%2Dweight%3A%20700%3B%0Acolor%3A%20%2300545D%3B%0A%7D%0Ah4%2C%20h5%2C%20h6%20%7B%0Afont%2Dweight%3A%20500%3B%0Acolor%3A%20%23000000%3B%0A%7D%0Ah1%20%7B%20font%2Dsize%3A%202%2E25rem%3B%20%7D%0Ah2%20%7B%20font%2Dsize%3A%201%2E875rem%3B%20%7D%0Ah3%20%7B%20font%2Dsize%3A%201%2E5rem%3B%20%7D%0Ah4%20%7B%20font%2Dsize%3A%201%2E25rem%3B%20%7D%0Ah5%20%7B%20font%2Dsize%3A%201%2E125rem%3B%20%7D%0Ah6%20%7B%20font%2Dsize%3A%201rem%3B%20%7D%0Ah4%2Eauthor%20%3E%20em%2C%20h4%2Edate%20%3E%20em%20%7B%0Afont%2Dfamily%3A%20%22Roboto%22%2C%20%22Times%20New%20Roman%22%2C%20Times%2C%20serif%3B%0Afont%2Dstyle%3A%20normal%3B%0Afont%2Dweight%3A%20400%3B%0Acolor%3A%20%23858587%3B%0A%7D%0A%0Aul%3Anot%28%5Bclass%5D%29%20%7B%0Afont%2Dsize%3A%201rem%3B%0Alist%2Dstyle%3A%20none%3B%0A%7D%0Aul%3Anot%28%5Bclass%5D%29%20li%3Abefore%20%7B%0Acolor%3A%20%23EB6E08%3B%0Acontent%3A%20%22%5C2022%22%3B%0Amargin%2Dleft%3A%20%2D0%2E75em%3B%0Aposition%3A%20relative%3B%0Atop%3A%200%2E125em%3B%0Aline%2Dheight%3A%200%3B%0Apadding%2Dright%3A%200%2E25em%3B%0Afont%2Dsize%3A%201%2E5em%3B%0A%7D%0A%0Aa%20%7B%0Acolor%3A%20%23168FA7%3B%0A%7D%0A%0Aul%2Enav%20%7B%0Afont%2Dweight%3A%20500%3B%0A%7D%0Aul%2Enav%20a%20%7B%0Acolor%3A%20%23168FA7%3B%0A%7D%0A%0A%0A%2Epagedtable%2Dwrapper%20%7B%0Afont%2Dsize%3A%201rem%3B%0Aborder%2Dwidth%3A%200%3B%0A%7D%0A%2Epagedtable%2Dwrapper%20%2Epagedtable%20%7B%0Apadding%3A%200%3B%0A%7D%0A%2Epagedtable%2Dwrapper%20a%20%7B%0Acolor%3A%20%23168FA7%3B%0A%7D%0A%2Epagedtable%2Dwrapper%20a%2Epagedtable%2Dindex%2Dnav%2Ddisabled%20%7B%0Acolor%3A%20%23999%3B%0A%7D%0A%2Epagedtable%2Dwrapper%20a%2Epagedtable%2Dindex%2Dcurrent%20%7B%0Acolor%3A%20%23333%3B%0A%7D%0A%0Atable%20thead%20%7B%0Afont%2Dsize%3A%200%2E7em%3B%0Acolor%3A%20%23FFFFFF%3B%0Abackground%2Dcolor%3A%20%2300545D%3B%0A%7D%0Atable%20tr%2Eodd%20%7B%0Afont%2Dsize%3A%200%2E7em%3B%0Abackground%2Dcolor%3A%20%23EFF0F0%3B%0A%7D%0Atable%20tr%2Eeven%20%7B%0Afont%2Dsize%3A%200%2E7em%3B%0Abackground%2Dcolor%3A%20%23DFE0E1%3B%0A%7D%0A%0Abutton%2C%20input%20%7B%0Afont%2Dsize%3A%2001rem%3B%0Aborder%2Dradius%3A%200%2E25em%3B%0Amargin%2Dbottom%3A%200%2E625em%3B%0Apadding%3A%200%2E625em%3B%0Aoutline%3A%20none%3B%0A%7D%0Ainput%5Btype%3Dtext%5D%2C%20input%5Btype%3Dnumber%5D%2C%20select%20%7B%0Afont%2Dweight%3A%20300%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Amin%2Dwidth%3A%2012em%3B%0A%7D%0Abutton%2C%20input%5Btype%3Dsubmit%5D%20%7B%0Afont%2Dweight%3A%20900%3B%0Aborder%3A%20none%3B%0Apadding%3A%200%2E625em%201%2E875em%3B%0Abackground%2Dcolor%3A%20%23EB6E08%3B%0Acolor%3A%20%23FFFFFF%3B%0Acursor%3A%20pointer%3B%0Amin%2Dwidth%3A%20inherit%3B%0A%7D%0Abutton%3Ahover%2C%20input%5Btype%3Dsubmit%5D%3Ahover%20%7B%0Abackground%2Dcolor%3A%20%23f29d63%3B%0A%7D%0A%0Aimg%2C%20iframe%20%7B%0Adisplay%3A%20block%3B%0Amargin%3A%200%20auto%3B%0A%7D%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Handling of company hierarchies</h1>
<h4 class="author"><em>Mark Zwart</em></h4>
<h4 class="date"><em>2018-11-09</em></h4>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>In our database we can find the relations between companies by a parent child relation, but there is a lot of information that can be gained from the total total tree of company relations. This package contains several functions that is useful for extracting this kind of information, and for plotting the total company hierarchy.</p>
<div id="the-example-data" class="section level3">
<h3>The example data</h3>
<p>First let’s load the package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(graydon.package)</code></pre></div>
<p>The package contains a data frame, <em>tbl_company_relations</em> which is an ex(s)ample of how company relations are typically represented in our database (<em>id_company</em>, <em>id_company_parent</em>), with some extra added data about each of the companies. The data frame contains the following columns:</p>
<table>
<thead>
<tr class="header">
<th align="left">Column.names</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">id_company</td>
</tr>
<tr class="even">
<td align="left">id_company_parent</td>
</tr>
<tr class="odd">
<td align="left">code_sbi</td>
</tr>
<tr class="even">
<td align="left">size_company</td>
</tr>
<tr class="odd">
<td align="left">qty_employees</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="creating-a-company-hierarchy-graph" class="section level1">
<h1>Creating a company hierarchy graph</h1>
<p>Company relations in our database are represented in parent-child relations, but this doesn’t give you the complete overview of how companies fit together in their complete hierarchy. [Graphs](<a href="https://en.wikipedia.org/wiki/Graph_(discrete_mathematics)" class="uri">https://en.wikipedia.org/wiki/Graph_(discrete_mathematics)</a> provide a way of getting those overviews. Let’s load the <a href="http://igraph.org/r/doc/"><em>igraph</em></a> library first:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(igraph)</code></pre></div>
<p>With a simple function call we can create a graph, based on those parent-child relationships expressed in a table. Make sure the child and the parent ID columns are the first and second column in the table respectively.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">graph_company_hierarchies &lt;-<span class="st"> </span><span class="kw">create_graph_company_hierarchies</span>(tbl_company_relations)</code></pre></div>
<p>The resulting graph represents a network of all individual company hierarchies in one big ‘space’ which can be graphically represented like below. You can see this plot is pretty useless in in itself, but this ‘space’ of hierarchies can be used as a ‘database’ to easily retrieve the desired company hierarchies which are usefull for plotting and doing calculations within those.</p>
<p>The <em>plot_graydon_graph</em> function is used to plot graphs using graydon colors, the extra parameters <em>vertex.label</em>, <em>vertex.size</em> and <em>edge.arrow.size</em> are set so they override the defaults.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot_graydon_graph</span>(graph_company_hierarchies,
                   <span class="dt">vertex.label =</span> <span class="st">&quot;&quot;</span>,
                   <span class="dt">vertex.size =</span> <span class="dv">4</span>,
                   <span class="dt">edge.arrow.size =</span> <span class="dv">0</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="selecting-company-hierarchies-graphs" class="section level1">
<h1>Selecting company hierarchies graphs</h1>
<p>There are a few ways which we can select the distinct company hierarchies so we can make useful calculations or plots about them: you can either select them individually or by bulk.</p>
<div id="selecting-a-hierarchy-by-company-id" class="section level2">
<h2>Selecting a hierarchy by company ID</h2>
<p>If you have a single company that you want to find out about more you can select it using the function <em>find_company_hierarchy</em>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">id_company_selected &lt;-<span class="st"> &quot;931238099&quot;</span>
graph_company_hierarchy &lt;-<span class="st"> </span><span class="kw">find_company_hierarchy</span>(graph_company_hierarchies, id_company_selected)</code></pre></div>
<p>The resulting graph has the logical attribute <em>is_searched_company</em> set to <em>TRUE</em> of the searched for company. Let’s plot this graph, highlighting the searched for companies:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">igraph<span class="op">::</span><span class="kw">V</span>(graph_company_hierarchy)<span class="op">$</span>color &lt;-<span class="st"> </span><span class="kw">ifelse</span>(igraph<span class="op">::</span><span class="kw">V</span>(graph_company_hierarchy)<span class="op">$</span>is_searched_company,
                                                   col_graydon[<span class="dv">2</span>],
                                                   col_graydon[<span class="dv">4</span>])
<span class="kw">plot_graydon_graph</span>(graph_company_hierarchy)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="selecting-hierarchies-with-a-column-of-company-ids" class="section level2">
<h2>Selecting hierarchies with a column of company IDs</h2>
<p>A customer’s file contains multiple companies of which we might want to calculate, or show (parts) of their hierarchy. The <em>list_selected_hierarchies</em> function can be used to put the graphs of all these companies in a list. In this example we have a data frame <em>tbl_customers</em> with the column <em>id_company</em>, of which we want to retrieve all the graphs.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">list_selected_hierarchies &lt;-<span class="st"> </span><span class="kw">select_graph_hierarchies</span>(graph_company_hierarchies, 
                                                      tbl_customers<span class="op">$</span>id_company)</code></pre></div>
<p>Note that the <em>tbl_customers</em> data-frame contains 300, while the <em>list_selected_hierarchies</em> contains 249 graphs; this is because there are customers that fall within the same company hierarchy. The companies in the graphs in this list now also contain an extra logical attribute, <em>is_searched_company</em>, which indicates whether the company was in the <em>id_company</em> column. Let’s take a look at one of the graphs that contain multiple customers. The customer ‘vertices’ are colored orange here:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">igraph<span class="op">::</span><span class="kw">V</span>(graph_example)<span class="op">$</span>color &lt;-<span class="st"> </span><span class="kw">ifelse</span>(igraph<span class="op">::</span><span class="kw">V</span>(graph_example)<span class="op">$</span>is_searched_company,
                                                   col_graydon[<span class="dv">2</span>],
                                                   col_graydon[<span class="dv">4</span>])

<span class="kw">plot_graydon_graph</span>(graph_example,
                   <span class="dt">vertex.label =</span> <span class="st">&quot;&quot;</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="listing-all-hierarchy-graphs" class="section level2">
<h2>Listing all hierarchy graphs</h2>
<p>For whatever reason, you might want to creating a list of all of the seperate company hierarchies out of the complete company hierarchy ‘space’. This will take some time, so take some coffee….</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">list_all_graphs &lt;-<span class="st"> </span><span class="kw">list_company_hierarchy_graphs</span>(graph_company_hierarchies)</code></pre></div>
</div>
</div>
<div id="converting-company-hierarchy-graphs-to-data-frames" class="section level1">
<h1>Converting company hierarchy graphs to data-frames</h1>
<p>Having graphs is nice for creating beautiful plots and useful calculations, but for the data to be useful for further processing, getting data from the graph into a data-frame format is handy.</p>
<div id="converting-a-single-hierarchy-graph" class="section level2">
<h2>Converting a single hierarchy graph</h2>
<p>To turn a graph into a data-frame youy can use the function <em>hierarchy_as_data_frame</em>. We created the graph <em>graph_company_hierarchy</em> by searching hierarchies by company IDs and set the colors to them being in the searched-for companies, this is reflected by the <em>graph_company_hierarchy</em> and <em>color</em> columns respectively.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_single_hierarchy &lt;-<span class="st"> </span><span class="kw">hierarchy_as_data_frame</span>(graph_company_hierarchy)</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="right">id_company_parent</th>
<th align="left">code_sbi</th>
<th align="right">size_company</th>
<th align="right">qty_employees</th>
<th align="left">is_searched_company</th>
<th align="left">color</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1003667</td>
<td align="right">931238099</td>
<td align="left">7022</td>
<td align="right">2</td>
<td align="right">15</td>
<td align="left">FALSE</td>
<td align="left">#8BB0DE</td>
</tr>
<tr class="even">
<td align="left">931238099</td>
<td align="right">933898487</td>
<td align="left">6420</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">#EB6E08</td>
</tr>
<tr class="odd">
<td align="left">933898487</td>
<td align="right">911277358</td>
<td align="left">7022</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">FALSE</td>
<td align="left">#8BB0DE</td>
</tr>
<tr class="even">
<td align="left">936298138</td>
<td align="right">931238099</td>
<td align="left">7311</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="left">FALSE</td>
<td align="left">#8BB0DE</td>
</tr>
<tr class="odd">
<td align="left">911277358</td>
<td align="right">NA</td>
<td align="left">6420</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="left">#8BB0DE</td>
</tr>
</tbody>
</table>
</div>
<div id="converting-a-list-of-hierarchy-graphs" class="section level2">
<h2>Converting a list of hierarchy graphs</h2>
<p>A list of graphs can also be converted into a data-frame using <em>hierarchy_list_as_data_frame</em>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_selected_hierarchies &lt;-<span class="st"> </span><span class="kw">hierarchy_list_as_data_frame</span>(list_selected_hierarchies)</code></pre></div>
</div>
</div>
<div id="calculating-properties" class="section level1">
<h1>Calculating properties</h1>
<div id="propagating-values" class="section level2">
<h2>Propagating values</h2>
<p>It might come in handy to cumulate values in the hierarchy bottom up; this is where the <em>aggregate_company_hierarchy_value</em> function comes in handy. In this example the companies will get a new attribute <em>qty_employees_cum</em> which will contain the sum of all the <em>qty_employees</em> of the companies that below the company within the hierarchy.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">graph_company_hierarchy &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">aggregate_company_hierarchy_value</span>(<span class="dt">graph =</span> graph_company_hierarchy, 
                                    <span class="dt">name_attribute =</span> <span class="st">&quot;qty_employees&quot;</span>,
                                    <span class="dt">name_aggregate =</span> <span class="st">&quot;qty_employees_cum&quot;</span>,
                                    <span class="dt">FUN =</span> sum, 
                                    <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>The result can be found can be shown in a graph, where we can see the original values and the rolled up values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">igraph<span class="op">::</span><span class="kw">V</span>(graph_company_hierarchy)<span class="op">$</span>label &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;# &quot;</span>,
                                                   igraph<span class="op">::</span><span class="kw">V</span>(graph_company_hierarchy)<span class="op">$</span>qty_employees,
                                                   <span class="st">&quot; -&gt; Cum # &quot;</span>,
                                                   igraph<span class="op">::</span><span class="kw">V</span>(graph_company_hierarchy)<span class="op">$</span>qty_employees_cum)

<span class="kw">plot_graydon_graph</span>(graph_company_hierarchy)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="adding-graph-statistics" class="section level2">
<h2>Adding graph statistics</h2>
<p>Some overall statistics about the hierarchy can be added to the individual companies by using the <em>add_company_hierarchy_stats</em> function. This function will add the following attributes * <em>is_tree</em> - A logical indicating whether the company hierarchy is a tree (which should always be the case). * <em>qty_comapny_hierarchy</em> - The the number of companies in the hierarchy. * <em>id_company_top</em> - The company ID of the highest company in the hierachy (ultimate mother). * <em>distance_to_top</em> - The number of companies between the current company and the ultimate mother company * <em>qty_child_companies</em> - The number of child companies. * <em>qty_sister_companies</em> - The number of sibling companies.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">graph_company_hierarchy &lt;-<span class="st"> </span><span class="kw">add_company_hierarchy_stats</span>(graph_company_hierarchy)</code></pre></div>
<p>Let’s look at the statistics:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_single_hierarchy &lt;-<span class="st"> </span><span class="kw">hierarchy_as_data_frame</span>(graph_company_hierarchy)</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="right">id_company_parent</th>
<th align="left">code_sbi</th>
<th align="right">size_company</th>
<th align="right">qty_employees</th>
<th align="left">is_searched_company</th>
<th align="right">qty_employees_cum</th>
<th align="left">is_tree</th>
<th align="right">qty_comapny_hierarchy</th>
<th align="left">id_company_top</th>
<th align="right">distance_to_top</th>
<th align="right">qty_child_companies</th>
<th align="right">qty_sister_companies</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1003667</td>
<td align="right">931238099</td>
<td align="left">7022</td>
<td align="right">2</td>
<td align="right">15</td>
<td align="left">FALSE</td>
<td align="right">15</td>
<td align="left">TRUE</td>
<td align="right">5</td>
<td align="left">911277358</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">931238099</td>
<td align="right">933898487</td>
<td align="left">6420</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="right">17</td>
<td align="left">TRUE</td>
<td align="right">5</td>
<td align="left">911277358</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">933898487</td>
<td align="right">911277358</td>
<td align="left">7022</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">FALSE</td>
<td align="right">17</td>
<td align="left">TRUE</td>
<td align="right">5</td>
<td align="left">911277358</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">936298138</td>
<td align="right">931238099</td>
<td align="left">7311</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="left">FALSE</td>
<td align="right">2</td>
<td align="left">TRUE</td>
<td align="right">5</td>
<td align="left">911277358</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">911277358</td>
<td align="right">NA</td>
<td align="left">6420</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">18</td>
<td align="left">TRUE</td>
<td align="right">5</td>
<td align="left">911277358</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="marking-companies" class="section level2">
<h2>Marking companies</h2>
<p>You can mark companies within a graphthat meet certain categorical criteria with the function <em>mark_companies_logical</em>. This can be useful for derivations or coloring graphs. As a somewhat travial example, let’s mark the companies that have SBI codes (from <em>code_sbi</em>) that are a associated with holdings (that are in the vector <em>vec_sbi_holdings</em>). The new company attribute name will be <em>is_holding</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vec_sbi_holdings &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;64&quot;</span>, <span class="st">&quot;642&quot;</span>, <span class="st">&quot;6420&quot;</span>)

graph_company_hierarchy &lt;-<span class="st"> </span><span class="kw">mark_companies_logical</span>(graph_company_hierarchy,
                                                  <span class="dt">name_logical =</span> <span class="st">&quot;is_holding&quot;</span>,
                                                  <span class="dt">name_filter =</span> <span class="st">&quot;code_sbi&quot;</span>,
                                                  <span class="dt">set_criteria =</span> vec_sbi_holdings)</code></pre></div>
</div>
<div id="sister-companies" class="section level2">
<h2>Sister companies</h2>
<p>You can get the siblings IDs of a company using the function <em>get_sibling_ids</em>, which in turn can be used to mark companies and plot them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">id_siblings &lt;-<span class="st"> </span><span class="kw">get_sibling_ids</span>(graph_company_hierarchy, <span class="st">&quot;1003667&quot;</span>)

graph_company_hierarchy &lt;-<span class="st"> </span><span class="kw">mark_companies_logical</span>(graph_company_hierarchy,
                                                  <span class="dt">name_logical =</span> <span class="st">&quot;is_sibling&quot;</span>, 
                                                  <span class="dt">name_filter =</span> <span class="st">&quot;id_company&quot;</span>,
                                                  <span class="dt">set_criteria =</span> id_siblings
                                                  )

igraph<span class="op">::</span><span class="kw">V</span>(graph_company_hierarchy)<span class="op">$</span>label &lt;-<span class="st"> </span>igraph<span class="op">::</span><span class="kw">V</span>(graph_company_hierarchy)<span class="op">$</span>name
<span class="kw">V</span>(graph_company_hierarchy)<span class="op">$</span>color &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">V</span>(graph_company_hierarchy)<span class="op">$</span>is_sibling,
                                                   col_graydon[<span class="dv">2</span>],
                                                   col_graydon[<span class="dv">4</span>])

<span class="kw">plot_graydon_graph</span>(graph_company_hierarchy)</code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAABTVBMVEUAAAAAADoAAGYAGQMAGQQAHzYAH0wAJ30AOmYAOpAARp4ATIoAZrYfH0wfNUwfNWAfS3QgY78qAE0qK00qTIoqa6Y1Hx81HzY1NR81X4c4AFk4ft46AAA6AGY6Ojo6OmY6OpA6ZpA6ZrY6kNtKAE1KiMFLHwBLHx9LcodOJwBOJzJOl95fSx9fhYdjRjJjsN5mADpmAGZmOgBmOjpmOmZmOpBmZjpmkNtmtv9pKwBpiG1ppMFySx9yhYd3YzJ3sL93sN6FTCyFhXSFhYeFpMGFv8GLflmLsJ6LsL+LsN6QOgCQOjqQtpCQ2/+ga02gv8GoLAOoPgO2ZgC2Zjq2kDq2tma22/+2//+6iE26pG26pIq6pKa6v4q6v6a6v8HJbgjbkDrbkGbb29vb2//b///rTgPrbgbrbgj/tmb/25D/27b/29v//7b//9v///+R6lmIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAHZklEQVR4nO3d+3vTVACH8YqXMZ1y8YoMnUyQiyAI4tQBs4XZMOZlw3JRwtQC3Vzz///oOTknaTYH3yVr2sPD+z6PoYQ80HyStttyPGkk9Nwa434CoQeQCCARQCKARACJABIBJAJIBJAIIBFAIoBEAIkAEgEkAkgEkAggEUAigEQAiQASASQCSASQCCARQCKARACJABIBJAJIBJAIIBFAIoBEAIkAEgEkAkgEkAggEUAigEQAiQASASQCSASQCCARQCKARACJABIBJAJIBJAIIBFAIoBEAIkAEgEkAkgEkAggEUAigEQAiQASASQCSASQCCARQCKARACJABIBJKoTaLXxyrd22TieJP0707PucdevX0sf/7t67G62jVsTWDUC9Sa7GxeWzbJ/ay5Zmeyka8xjt379WMc8Xv/09sW7fr1bU/qfccR/TVtityweknS50jBNVduLGoHWzPNbm+t3k/7S8qZhSJINg7QyN3+wZdZnHPZP3DbVgByx506XxUPil6bV8vRp9Z5B/VuzSf9WYzZZ/+TrxqR9+WxcPvf4tUdNs34tPc4pkNsmW1M2+zf0puwBccvm1VZ+SNzSPvim4ou33veg/VfscbNHdV+nv2IMNi+devr018arH5kXV6e/NJfvQvpyc2vKtg3oYNQ+nR+S/MDY07lS9X6KmSNpXj7+qZv/zO9bT01Pvlh2u5S/xPLjX/4f2Qo0fyiKovZJf0jyA5OdSaWrFah/Z6br3hE2LyybJ2pPEAv05Le3u739HfsCdLvn3rz9mrJtB2ovRNG8PyT+wFQ/gWoF6jU+M+++5jPFPLv1afObnv00eePR48Y73Ti2nzhdfwa5bfyasm0W3qRvPDx5dHFiwZxB7pC4pT1zq+7EGL5QbLVa9pc4HtLfl7580g/4+GezbLXPDw6JX/YqfsYn4/1KemhEW/86fwCG1Hi/1Rgi0ZC188b9vdiQ9qsunvEDDWXf6uMJAWiv+xfXyRMG0F6I6tVJQgGquqO184QDVGVnR8ATElDZd5OR8IQFlJTY6xHxBAc02PMdAeJtG42g4ID83u/4cnPrav5c31aAQCnEM4DiUZ48aUECpRT/l9hxZd2FBFS4TBT/8ePhm3F+mchfFHrvl/QHGoMt7bLmAgIqXCY6cf/d7z+/Gd/LLhOZ5f3DNx5+d+L+4U5+4cgt635WAQEVLhP9EMd/GqAHN+Jk5Ujzql3jgO69FZvt3JZuWfezCgioeJnI/5wwjh98+FXUPtl4P3YXhfzPntMt/fY1FxBQ8TJRdh1i84OzkamZXRTyP4B3W2bb11pIQIXLRNkFxaVTUdReiFrZRaH8CoX7Mfwefhi/24ICGlwm8lc7luZaUbQ4sdDMLgpll6ftltmy3kICKl4mcle77GWiievnCxeF3PCEdEu/rLmQgHZuuBcpShc+0M7fto4sgEQAiQASASQCSASQCCARQCKARACJABIBJAJIBJAIIBFAIoBEAIkAEgEkAkgUOlAcj2VU0KDQgcYzaqoQQKLggRKAROP1AUgFkOhFABrrPx8SUHG2mMJ8MHFxthjz62TXPd7LlCW7LyCg4mwxxflg7hVmi7H/t/dkdzANStUpS3ZfQEDF2WIK88EcmT+YDGaL6S/dnhkAVZ6yZPcFBLRlGHA+H8yBaHHiaj+fLWZtdn2mm88TU33GiV0XENDWYcB+PpjmmaPR+cbrV/ww4PXjiQHaNnNMrYUEVBgGnM8H07pmZ3NpLvnZYtI35n2/+8HAIziBwgIaDAPO54NpnjZA7S9n8tli7BnkH49glHRYQIVhwIP5YA4sRIvpcN9sbhj7HuQe72HKkt0XEtDOMQw47F4AIL7VEAEkAkgEkAggEUAigEQAiQASASQCSASQCCARQCKARAA9L0aYqRhAJRqzD0Cq4IEYH6QCSASQiq+DfG4gmbsb1uC2Y34gmR9Olg88a8yO6HZk4QD52465u2EVbjtmz6BVP5wsuzOW/W3F25GVLRygbN7IwX2v3O3IWq2WG0hmlm7gWbJqR3W8dEDZvJFbbgy2cflcZG9lZB+vZQPPzKKx/27V25GVLBygbIBZEWjz0inj89PH55LijciSv7v9lamqtyMrWUBAft7IApC9HZkBunbIDoBJTyA3C+U/2Z2xXrIxim7eyAFQejuyKGqfOdvyeP5mZRc7/dWpqrcjK1lAQH7eyAGQux3ZwuKb9gRKh5P5gWe9aXtfvoq3IytZQEDPiBFmYQeQCCARQCKARACJABIBJAJIBJAIIBFAIoBEAIkAEgEkAkgEkAggEUAigEQAiQASASQCSASQCCARQCKARACJABIBJAJIBJAIIBFAIoBEAIkAEgEkAkgEkAggEUAigEQAiQASASQCSASQCCARQCKARACJABIBJAJIBJAIIBFAIoBEAIkAEgEkAkgEkAggEUAigEQAiQASASQCSASQCCARQCKARACJABIBJAJIBJAIIBFAIoBEAIkAEgEkAkgEkAggEUAigEQAiQASASQCSASQCCARQCKARACJ/gMlrheqPtKurgAAAABJRU5ErkJggg==" /><!-- --></p>
<p>Remember the table of customers? If we want to get all siblings of those companies we can use the function <em>get_siblings_df</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tbl_siblings &lt;-<span class="st"> </span><span class="kw">get_siblings_df</span>(graph_company_hierarchies, tbl_customers<span class="op">$</span>id_company)</code></pre></div>
<p>Below you can see a sample of the resulting data-frame, where you can see the company with it’s siblings and the <em>qty_siblings</em> indicating the total number of siblings the company of <em>id_company</em> has.</p>
<table>
<thead>
<tr class="header">
<th align="left">id_company</th>
<th align="left">id_sibling</th>
<th align="right">qty_siblings</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1049718</td>
<td align="left">995993</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">933400462</td>
<td align="left">927548399</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">936252847</td>
<td align="left">908523750</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">936252847</td>
<td align="left">908523769</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">936252847</td>
<td align="left">930178726</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">936252847</td>
<td align="left">930351355</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
</div>
<div id="recoding-holdings" class="section level2">
<h2>Recoding holdings</h2>
<p>When dealing with customers you’ll ofen encounter them having economic activity codes that mark them as financial holdings. This is often the case because this is the company you send the bills too. But this is not really informative when analysing the type of companies you have as customers. In this case you might want to recode them to better reflect what kind of business they are really in.</p>
<p>Here you see an example of a company hierarchy with some holdings, which are colored orange here:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vec_sbi_holdings &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;64&quot;</span>, <span class="st">&quot;642&quot;</span>, <span class="st">&quot;6420&quot;</span>)

graph_company_hierarchy &lt;-<span class="st"> </span><span class="kw">mark_companies_logical</span>(graph_company_hierarchy,
                                                  <span class="dt">name_logical =</span> <span class="st">&quot;is_holding&quot;</span>,
                                                  <span class="dt">name_filter =</span> <span class="st">&quot;code_sbi&quot;</span>,
                                                  <span class="dt">set_criteria =</span> vec_sbi_holdings)

igraph<span class="op">::</span><span class="kw">V</span>(graph_company_hierarchy)<span class="op">$</span>label &lt;-<span class="st"> </span>igraph<span class="op">::</span><span class="kw">V</span>(graph_company_hierarchy)<span class="op">$</span>code_sbi
<span class="kw">V</span>(graph_company_hierarchy)<span class="op">$</span>color &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">V</span>(graph_company_hierarchy)<span class="op">$</span>is_holding,
                                                   col_graydon[<span class="dv">2</span>],
                                                   col_graydon[<span class="dv">4</span>])

<span class="kw">plot_graydon_graph</span>(graph_company_hierarchy)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>You can use the function <em>recode_holding_codes</em> to recode the holdings so they reflect the economic activity codes of the majority of the children:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">graph_company_hierarchy &lt;-<span class="st"> </span><span class="kw">recode_holding_codes</span>(graph_company_hierarchy, 
                                                <span class="dt">name_activity_code =</span> <span class="st">&quot;code_sbi&quot;</span>, 
                                                <span class="dt">vec_holding_codes =</span> <span class="kw">c</span>(<span class="st">&quot;64&quot;</span>, <span class="st">&quot;642&quot;</span>, <span class="st">&quot;6420&quot;</span>))</code></pre></div>
<p>This would result in this recoded company hierarchy: <img src="data:image/png;base64,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" /><!-- --></p>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
